# ğŸ” å¡å¯†ç®¡å®¶

ä¸€ä¸ªç°ä»£åŒ–çš„å¡å¯†ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒæ‰¹é‡å¯¼å…¥å¯¼å‡ºã€åˆ†ç±»æ ‡ç­¾ã€å¤‡æ³¨ç®¡ç†å’Œå…¬å‘ŠåŠŸèƒ½ã€‚

![React](https://img.shields.io/badge/React-19-61dafb?logo=react)
![TypeScript](https://img.shields.io/badge/TypeScript-5.9-3178c6?logo=typescript)
![MySQL](https://img.shields.io/badge/MySQL-8-4479a1?logo=mysql&logoColor=white)
![Express](https://img.shields.io/badge/Express-4-000000?logo=express)
![Vite](https://img.shields.io/badge/Vite-7-646cff?logo=vite&logoColor=white)

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ“‹ **æ‰¹é‡å¯¼å…¥** - ä»å‰ªè´´æ¿ä¸€é”®å¯¼å…¥å¡å¯†ï¼Œè‡ªåŠ¨å»é‡å»ç©º
- ğŸ“¤ **çµæ´»å¯¼å‡º** - æ”¯æŒå¯¼å‡ºå…¨éƒ¨/ç­›é€‰åçš„å¡å¯†ï¼Œå¯é€‰æ˜¯å¦åŒ…å«å¤‡æ³¨
- ğŸ·ï¸ **åˆ†ç±»ç®¡ç†** - è‡ªå®šä¹‰åˆ†ç±»æ ‡ç­¾å’Œé¢œè‰²ï¼Œå¿«é€Ÿç­›é€‰
- ğŸ“ **å¤‡æ³¨åŠŸèƒ½** - ä¸ºæ¯ä¸ªå¡å¯†æ·»åŠ å¤‡æ³¨å’Œä½¿ç”¨è€…ä¿¡æ¯
- ğŸ“¢ **å…¬å‘Šæ ** - é¡¶éƒ¨å¯ç¼–è¾‘å…¬å‘ŠåŒºåŸŸ
- ğŸ” **æœç´¢ç­›é€‰** - æŒ‰å¡å¯†ã€å¤‡æ³¨ã€ä½¿ç”¨è€…æœç´¢ï¼ŒæŒ‰çŠ¶æ€ç­›é€‰
- âœ… **æ‰¹é‡æ“ä½œ** - å¤šé€‰åæ‰¹é‡è®¾ç½®åˆ†ç±»ã€å¤‡æ³¨ã€æ ‡è®°çŠ¶æ€ã€åˆ é™¤
- ğŸ¨ **æµç•…åŠ¨ç”»** - åŸºäº Framer Motion çš„ç²¾è‡´äº¤äº’åŠ¨ç”»
- ğŸ’¾ **æ•°æ®æŒä¹…åŒ–** - æ”¯æŒ IndexedDB æœ¬åœ°å­˜å‚¨æˆ– MySQL äº‘ç«¯å­˜å‚¨

## ğŸ“¸ ç•Œé¢é¢„è§ˆ

```
+--------------------------------------------------+
|              ğŸ“¢ å…¬å‘Šæ  (å¯ç¼–è¾‘)                    |
+--------------------------------------------------+
| [å¯¼å…¥] [å¯¼å‡ºâ–¼]              ğŸ” æœç´¢æ¡†   [çŠ¶æ€ç­›é€‰] |
+--------------------------------------------------+
| [å…¨éƒ¨] [æœªåˆ†ç±»] [VIP] [æ™®é€š] [æµ‹è¯•] [+æ·»åŠ åˆ†ç±»]    |
+--------------------------------------------------+
|  â–¡ | å¡å¯†ä»£ç       | åˆ†ç±»  | å¤‡æ³¨   | ä½¿ç”¨è€… | çŠ¶æ€|
|  â–¡ | XXXX-XXXX    | VIP   | æµ‹è¯•ç”¨ | å¼ ä¸‰   | å·²ç”¨|
|  â–¡ | YYYY-YYYY    | æ™®é€š  |        |        | æœªç”¨|
+--------------------------------------------------+
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

**å‰ç«¯:**
- React 19 + TypeScript 5.9
- Vite 7 (æ„å»ºå·¥å…·)
- Framer Motion (åŠ¨ç”»)
- Lucide React (å›¾æ ‡)
- CSS Modules

**åç«¯:**
- Node.js 18+ + Express 4
- MySQL 8.0+
- mysql2 (æ•°æ®åº“é©±åŠ¨)

**æœ¬åœ°å­˜å‚¨ (å¯é€‰):**
- IndexedDB + Dexie.js

## ğŸ“¦ å®‰è£…éƒ¨ç½²

### æ–¹å¼ä¸€ï¼šä»…å‰ç«¯ (IndexedDB æœ¬åœ°å­˜å‚¨)

é€‚åˆä¸ªäººä½¿ç”¨ï¼Œæ•°æ®å­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°ã€‚

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/Github-2333-top/kami-manager.git
cd kami-manager

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

è®¿é—® http://localhost:5173

### æ–¹å¼äºŒï¼šå‰ç«¯ + MySQL åç«¯

é€‚åˆå¤šè®¾å¤‡åŒæ­¥æˆ–å›¢é˜Ÿä½¿ç”¨ã€‚

#### 1. ç¯å¢ƒè¦æ±‚

- Node.js 18+
- MySQL 8.0+

#### 2. é…ç½®æ•°æ®åº“

ç¼–è¾‘ `server/db.js`ï¼Œä¿®æ”¹ MySQL è¿æ¥ä¿¡æ¯ï¼š

```javascript
const config = {
  host: 'localhost',
  port: 3306,
  user: 'root',           // MySQL ç”¨æˆ·å
  password: 'your_password', // MySQL å¯†ç 
  database: 'kami_manager',
}
```

#### 3. å®‰è£…å¹¶å¯åŠ¨

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/Github-2333-top/kami-manager.git
cd kami-manager

# å®‰è£…å‰ç«¯ä¾èµ–
npm install

# å®‰è£…åç«¯ä¾èµ–
cd server
npm install
cd ..

# å¯åŠ¨åç«¯ (ç»ˆç«¯1)
cd server
npm run dev

# å¯åŠ¨å‰ç«¯ (ç»ˆç«¯2)
npm run dev
```

- å‰ç«¯è®¿é—®: http://localhost:5173
- åç«¯ API: http://localhost:14124/api

> ğŸ’¡ æ•°æ®åº“å’Œè¡¨ä¼šåœ¨é¦–æ¬¡å¯åŠ¨åç«¯æ—¶è‡ªåŠ¨åˆ›å»º

## ğŸ“ é¡¹ç›®ç»“æ„

```
kami-manager/
â”œâ”€â”€ public/               # é™æ€èµ„æº
â”œâ”€â”€ server/               # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ src/              # TypeScript æºç 
â”‚   â”‚   â”œâ”€â”€ index.ts      # Express å…¥å£
â”‚   â”‚   â”œâ”€â”€ db.ts         # MySQL é…ç½®
â”‚   â”‚   â”œâ”€â”€ routes/       # è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ middleware/  # ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ services/    # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ migrations/       # æ•°æ®åº“è¿ç§»è„šæœ¬
â”‚   â”œâ”€â”€ tsconfig.json     # TypeScript é…ç½®
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/              # API è¯·æ±‚å°è£…
â”‚   â”œâ”€â”€ components/       # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Announcement/ # å…¬å‘Šæ 
â”‚   â”‚   â”œâ”€â”€ BatchActions/ # æ‰¹é‡æ“ä½œæ 
â”‚   â”‚   â”œâ”€â”€ CardItem/     # å¡å¯†é¡¹
â”‚   â”‚   â”œâ”€â”€ CardList/     # å¡å¯†åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ CategoryTabs/ # åˆ†ç±»æ ‡ç­¾
â”‚   â”‚   â”œâ”€â”€ ColorPicker/  # é¢œè‰²é€‰æ‹©å™¨
â”‚   â”‚   â”œâ”€â”€ ImportModal/  # å¯¼å…¥å¼¹çª—
â”‚   â”‚   â”œâ”€â”€ Loading/      # åŠ è½½çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ Modal/        # é€šç”¨å¼¹çª—
â”‚   â”‚   â”œâ”€â”€ Toast/        # æ¶ˆæ¯æç¤º
â”‚   â”‚   â””â”€â”€ Toolbar/      # å·¥å…·æ 
â”‚   â”œâ”€â”€ db/               # IndexedDB é…ç½®
â”‚   â”œâ”€â”€ hooks/            # è‡ªå®šä¹‰ Hooks
â”‚   â”œâ”€â”€ types/            # TypeScript ç±»å‹
â”‚   â”œâ”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ App.tsx           # ä¸»ç»„ä»¶
â”‚   â””â”€â”€ main.tsx          # å…¥å£æ–‡ä»¶
â”œâ”€â”€ index.html
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ vite.config.ts
```

## ğŸ—ƒï¸ æ•°æ®åº“ç»“æ„

### cards è¡¨ (å¡å¯†)
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | VARCHAR(36) | ä¸»é”® UUID |
| code | VARCHAR(255) | å¡å¯†ä»£ç  (å”¯ä¸€) |
| category_id | VARCHAR(36) | åˆ†ç±» ID |
| remark | TEXT | å¤‡æ³¨ |
| used_by | VARCHAR(255) | ä½¿ç”¨è€… |
| is_used | BOOLEAN | æ˜¯å¦å·²ä½¿ç”¨ |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ |

### categories è¡¨ (åˆ†ç±»)
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | VARCHAR(36) | ä¸»é”® UUID |
| name | VARCHAR(100) | åˆ†ç±»åç§° |
| color | VARCHAR(20) | é¢œè‰²ä»£ç  |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ |

### settings è¡¨ (è®¾ç½®)
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | VARCHAR(36) | ä¸»é”® |
| announcement | TEXT | å…¬å‘Šå†…å®¹ |

## ğŸ”Œ API æ¥å£

æ‰€æœ‰APIå·²è¿ç§»è‡³ `/api/v1/` è·¯å¾„ã€‚è¯¦ç»†æ–‡æ¡£è¯·å‚è€ƒ [API-v1.md](docs/API-v1.md)

### æ ¸å¿ƒæ¥å£

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /api/v1/health | å¥åº·æ£€æŸ¥ |
| GET | /api/v1/stats | è·å–ç»Ÿè®¡æ•°æ® |
| GET | /api/v1/settings | è·å–è®¾ç½® |
| PUT | /api/v1/settings/announcement | æ›´æ–°å…¬å‘Š |
| GET | /api/v1/categories | è·å–æ‰€æœ‰åˆ†ç±» |
| POST | /api/v1/categories | æ·»åŠ åˆ†ç±» |
| PUT | /api/v1/categories/:id | æ›´æ–°åˆ†ç±» |
| DELETE | /api/v1/categories/:id | åˆ é™¤åˆ†ç±» |
| GET | /api/v1/cards | è·å–æ‰€æœ‰å¡å¯† |
| POST | /api/v1/cards/batch | æ‰¹é‡æ·»åŠ å¡å¯† |
| PUT | /api/v1/cards/:id | æ›´æ–°å•ä¸ªå¡å¯† |
| PUT | /api/v1/cards/batch | æ‰¹é‡æ›´æ–°å¡å¯† |
| DELETE | /api/v1/cards/:id | åˆ é™¤å•ä¸ªå¡å¯† |
| DELETE | /api/v1/cards/batch | æ‰¹é‡åˆ é™¤å¡å¯† |

### ç¬¬ä¸‰æ–¹å¹³å°æ¥å£ï¼ˆéœ€è¦API Keyè®¤è¯ï¼‰

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /api/v1/cards/categories | è·å–æ‰€æœ‰å¯ç”¨åˆ†ç±»åˆ—è¡¨ |
| GET | /api/v1/cards?category_id={id} | æ ¹æ®åˆ†ç±»IDè·å–å¯ç”¨å¡ç‰‡åˆ—è¡¨ |
| POST | /api/v1/cards/withdraw | æ‰§è¡Œå–å¡æ“ä½œï¼ˆéšæœºå–ä¸€å¼ ï¼‰ |
| GET | /api/v1/cards/sync-status | æŸ¥è¯¢åŒæ­¥çŠ¶æ€ï¼ˆæ”¯æŒé•¿è½®è¯¢ï¼‰ |
| POST | /api/v1/webhooks | æ³¨å†ŒWebhookå›è°ƒ |
| GET | /api/v1/webhooks | æŸ¥è¯¢Webhookè®¢é˜…åˆ—è¡¨ |
| DELETE | /api/v1/webhooks/:id | åˆ é™¤Webhookè®¢é˜… |

## ğŸš€ ç”Ÿäº§éƒ¨ç½²

### 1. å‰ç«¯æ„å»º

```bash
npm run build
```

æ„å»ºäº§ç‰©åœ¨ `dist/` ç›®å½•ã€‚

### 2. åç«¯éƒ¨ç½² (PM2)

ä½¿ç”¨ PM2 è¿›è¡Œè¿›ç¨‹ç®¡ç†ï¼š

```bash
# å®‰è£… PM2
npm install -g pm2

# å¯åŠ¨åç«¯æœåŠ¡
cd server
# å®‰è£…ä¾èµ–å¹¶æ„å»ºï¼ˆç”Ÿæˆ dist/ï¼‰
npm install
npm run build
pm2 start index.js --name kami-server

# ä¿å­˜è¿›ç¨‹åˆ—è¡¨
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
```

**å¸¸ç”¨ PM2 å‘½ä»¤:**

```bash
pm2 ls                    # æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨
pm2 logs kami-server      # æŸ¥çœ‹æ—¥å¿—
pm2 restart kami-server   # é‡å¯æœåŠ¡
pm2 stop kami-server      # åœæ­¢æœåŠ¡
pm2 delete kami-server    # åˆ é™¤è¿›ç¨‹
```

### 3. Nginx åå‘ä»£ç†é…ç½®

```nginx
server {
    listen 443 ssl http2;
    server_name your-domain.com;

    # SSL è¯ä¹¦é…ç½®
    ssl_certificate /path/to/fullchain.pem;
    ssl_certificate_key /path/to/privkey.pem;

    # å‰ç«¯é™æ€èµ„æº
    location /kami_manager/ {
        alias /path/to/kami-manager/dist/;
        index index.html;
        try_files $uri $uri/ /kami_manager/index.html;
    }

    # å¤„ç† SPA è·¯ç”±å›é€€
    location = /kami_manager/index.html {
        alias /path/to/kami-manager/dist/index.html;
    }

    # API ä»£ç†ï¼ˆæ¨èï¼šä¸å‰ç«¯åŒå­è·¯å¾„ï¼Œé¿å…å‰ç«¯é¢å¤–é…ç½®ï¼‰
    location /kami_manager/api/v1/ {
        proxy_pass http://127.0.0.1:14124/kami_manager/api/v1/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # API å…¼å®¹ä»£ç†ï¼ˆå¯é€‰ï¼šå…¼å®¹æ—§è„šæœ¬ /api/v1/*ï¼‰
    location /api/v1/ {
        proxy_pass http://127.0.0.1:14124/api/v1/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript 
               application/javascript application/json application/xml;
}
```

é…ç½®å®Œæˆåé‡è½½ Nginxï¼š

```bash
sudo nginx -t && sudo systemctl reload nginx
```

### 4. Vite å­è·¯å¾„é…ç½®

å¦‚æœéƒ¨ç½²åœ¨å­è·¯å¾„ä¸‹ï¼ˆå¦‚ `/kami_manager/`ï¼‰ï¼Œéœ€è¦ä¿®æ”¹ `vite.config.ts`ï¼š

```typescript
export default defineConfig({
  base: '/kami_manager/',
  // ...å…¶ä»–é…ç½®
})
```

åŒæ—¶ç¡®è®¤ `src/api/client.ts` ä¸­çš„ API è·¯å¾„ä¸åç«¯ä¸€è‡´ï¼š

```typescript
const API_BASE = '/kami_manager/api/v1'
```

### 5. ç¯å¢ƒå˜é‡ (å¯é€‰)

å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®æ•°æ®åº“è¿æ¥ï¼š

```bash
export DB_HOST=localhost
export DB_PORT=3306
export DB_USER=root
export DB_PASSWORD=your_password
export DB_NAME=kami_manager
```

## ğŸ”§ æ•…éšœæ’æŸ¥

### 502 Bad Gateway

1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œï¼š`pm2 ls`
2. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼š`pm2 logs kami-server`
3. ç¡®è®¤ Nginx ä»£ç†ç«¯å£æ­£ç¡®ï¼ˆé»˜è®¤ 14124ï¼‰
4. é‡è½½ Nginx é…ç½®ï¼š`sudo nginx -t && sudo systemctl reload nginx`

### æ•°æ®åº“è¿æ¥å¤±è´¥

1. æ£€æŸ¥ MySQL æœåŠ¡çŠ¶æ€ï¼š`systemctl status mysql`
2. éªŒè¯æ•°æ®åº“é…ç½®ï¼š`server/db.js`
3. ç¡®è®¤ç”¨æˆ·æƒé™ï¼š`GRANT ALL ON kami_manager.* TO 'user'@'localhost';`

### å¥åº·æ£€æŸ¥

```bash
# ç›´æ¥è®¿é—®åç«¯
curl http://127.0.0.1:14124/kami_manager/api/v1/health

# é€šè¿‡ Nginx ä»£ç†
curl https://your-domain.com/kami_manager/api/v1/health
```

æ­£å¸¸è¿”å›ï¼š
```json
{"status":"healthy","timestamp":"...","database":"connected"}
```

## ğŸ“„ å¼€æºåè®®

[MIT License](LICENSE)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å‘èµ· Pull Request
